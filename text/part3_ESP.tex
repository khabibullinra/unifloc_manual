\section{Расчёт УЭЦН}
Пользовательские функции, связанные с расчётом установок электрических центробежных насосов приведены в модуле «u7\_Excel\_functions\_ESP».  Названия функций начинаются с префикса \mintinline{vb.net}{ESP_}. 

\begin{figure}[H]
	\begin{center}
		\input{draw/ESP_well_1}
		\caption{Схема конструктивных элементов ЭЦН}
		\label{ris:ESP_well_1}
	\end{center}
\end{figure}

УЭЦН состоит из следующих основных конструктивных элементов:
\begin{itemize}
	\item ЦН -- центробежный насос. Модуль обеспечивающий перекачку жидкости за счёт преобразования механической энергии вращения вала в гидравлическую мощность. 
	\item ПЭД -- погружной электрический двигатель. Модуль обеспечивающий преобразование электрической энергии, поступающей по кабелю к погружному электрическому двигателю в механическую энергию вращения вала.
	\item ГС -- газосепаратор или приёмный модуль. Модуль обеспечивающий забор пластовой жидкости из скважины и подачу ее в насос. При этом центробежный газосепаратор способен отделить часть свободного газа в потоке и направить его в межтрубное пространство скважины. Работает за счёт механической энергии вращения вала.
	\item вал -- узел передающий энергию от погружного электрического двигателя (ПЭД) к остальным узлам установки, в том числе к центробежному насосу.
	\item кабель - узел передающий электрическую энергию с поверхности к погружному электрическому двигателю
	\item НКТ - колонна насосно компрессорных труб, на которой подвешен насос
	\item ТР -- трансформатор -- узел обеспечивающий необходимое напряжение на кабеле на поверхности. Как правило на вход трансформатора подается напряжение 380 В, а на выходе оно поднимается до нескольких тысяч вольт. 
	\item СУ -- станция управления ЭЦН. Узел управляющий работой системы УЭЦН. Может запускать и  останавливать скважины, обеспечивает защиту установки ЭЦН при нежелательных режимах работы
	\item ЧРП -- частотно регулируемый привод. Обычно комплектуется со станцией управления УЭЦН. Обеспечивает изменение частоты колебаний напряжения и тока, а соответственно и частоты вращения вала ЭЦН. Может отсутствовать в компоновке УЭЦН. 
\end{itemize}

Элементы показаны на рисунке \ref{ris:ESP_well_1} где гидравлическая часть и электрическая обозначены разными цветами.

В промысловых сводках и отчётах часто ЭЦН обозначаются с использованием значений габарита насоса, номинальной подачи и номинального напора. ЭЦН5А 50 - 2000, означает что, это насос 5А габарита, с номинальной подачей 50 м3/сут и напором 2000 м. 

\begin{figure}[H]
	\center{\includegraphics[width=0.8\linewidth]{novomet_ESP_80}}
	\caption{Пример каталожных характеристик ЭЦН}
	\label{ris:novomet_ESP_80}
\end{figure}

УЭЦН, как и другие центробежные машины, обладает относительно узким диапазоном подач при которых достигается достаточно высокий КПД его работы (от 30 до 60\%). В связи с этим для различных подач выпускаются различные типы УЭЦН. Всего в промышленности используются сотни различных типов ЭЦН различных производителей. Характеристики различных насосов предоставляются производителями в каталогах оборудования и обычно встраиваются в расчётные программы в виде баз данных характеристик оборудования. В надстройке \unf{} содержится база данных характеристик ЭЦН, которая может быть использована при проведении расчетов пользовательскими функциями. База сокращенная, содержит ряд насосов только одного производителя. Как правило этого достаточно для проведения базовых расчетов, так как характеристики насосов одного типоразмера разных производителей схожи между собой. 

Для выбора определённого насоса из базы необходимо использовать его идентификатор в базе - \mintinline{vb.net}{pump_id}

\begin{figure}[H]
	\begin{center}
		\input{draw/ESP_well_2}
		\caption{Схема конструктивных элементов ЭЦН}
		\label{ris:ESP_well_2}
	\end{center}
\end{figure}


Задача расчёта УЭЦН обычно сводится к расчёту гидравлических и электрических характеристик ЭЦН, ключевые из которых показанных на рисунке \ref{ris:ESP_well_2}. Выделяют несколько режимов расчёта:
\begin{itemize}
	\item Прямая задача - по заданным значениям дебита жидкости скважины,  давлению на приеме, напряжению питания УЭЦН на поверхности найти давление на выкиде насоса, потребляемую электрическую мощность, потребляемый ток установки, КПД всей системы и отдельных узлов системы
	\item Обратная задача - по данным контроля параметров работы УЭЦН на поверхности - потребляемому току, напряжению питания частоте подаваемого напряжения, данным по конструкции УЭЦН и скважины найти дебит жидкости и обводнённость по скважине, давление на приёме и забойное давление.
	\item Задача узлового анализа - по данным конструкции скважины, параметров работы погружного оборудования оценить дебит по жидкости скважины при заданным параметрах работы УЭЦН или при их изменении. К этому типу задач относится задача подбора погружного оборудования для достижения заданных условий эксплуатации 
	
\end{itemize}

Для расчёта УЭЦН требуется рассчитать гидравлические параметры работы ЦН и электромеханические параметры ПЭД.

Более подробно про УЭЦН можно прочитать в книге Gabor Tacacs Electrical Submersible Pumps Manual \cite{Gabor_ESP}.

\subsection{База характеристик ЭЦН}
Для расчёта параметров работы УЭЦН необходимо иметь возможность работы с фактическими расходно напорными характеристиками различных типов ЭЦН. Такая возможность обеспечивается за счет наличия в составе \unf{} базы характеристик ЭЦН, которая находится в файле \mintinline{vb.net}{ESP_json.db}. Файл базы должен находиться рядом с надстройкой, название нельзя менять, оно жестко зашито в коде (актуально для версии 7.25).
Файл базы данных текстовый в формате \href{https://ru.wikipedia.org/wiki/JSON}{json}. Что обеспечивает достаточно простую работу с ним и потенциальную возможность внесения новых типов оборудования без привлечения внешних инструментов. Тем не менее в папке \mintinline{vb.net}{db/} репозитория можно найти вариант базы данных в формате Excel \mintinline{vb.net}{ESP_db.xlsm} с возможностью генерации json базы.    

\begin{figure}[H]
	\center{\includegraphics[width=1\linewidth]{ESP_db_1}}
	\caption{лист \mintinline{vb.net}{db_ESP_params} файла с базой ЭЦН}
	\label{ris:ESP_db_1}
\end{figure}

Файл \mintinline{vb.net}{ESP_db.xlsm} не зависит от надстройки \unf{} и может работать самостоятельно. База, фактически, состоит из двух таблиц на листах \mintinline{vb.net}{db_ESP_params} (смотри рисунок \ref{ris:ESP_db_1})  и \mintinline{vb.net}{db_ESP_curves} (смотри  рисунок \ref{ris:ESP_db_2}). Первая хранит параметры ЭЦН, вторая кривые расходно напорных характеристик. Таблицы связаны по идентификатору насоса \mintinline{vb.net}{ID}. Для добавления нового насоса следует добавить строку в таблицу на листе \mintinline{vb.net}{db_ESP_params} с соответствующими параметрами (все поля обязательны к заполнению) и добавить строки в таблицу \mintinline{vb.net}{db_ESP_curves} с тем же идентификатором \mintinline{vb.net}{ID} и значениями кривых РНХ (не менее 5 точек должно быть задано). При проведении расчётов кривые РНХ будут проинтерполированы кубическими сплайнами.  

\begin{figure}[H]
	\center{\includegraphics[width=1\linewidth]{ESP_db_2}}
	\caption{лист \mintinline{vb.net}{db_ESP_curves} файла с базой ЭЦН}
	\label{ris:ESP_db_2}
\end{figure}

Заголовки строки 5 на листе \mintinline{vb.net}{db_ESP_params} (смотри  рисунок \ref{ris:ESP_db_3}) определяют ключи параметров в json файле. Их нельзя менять, так как при считывании они жёстко зашиты в коде. Если в таблицу добавить столбец с новым названием, то он тоже будет записан в json файл, но не будет учитываться в расчётах без соответствующих модификаций в коде. Строка 4 должна быть пустой для корректной работы макроса (при считывании выделяется заполненная область вокруг левого верхнего угла таблицы - ячейки с названием \mintinline{vb.net}{db_ESP_params_topleft}).

\begin{figure}[H]
	\center{\includegraphics[width=1\linewidth]{ESP_db_3}}
	\caption{лист \mintinline{vb.net}{process} файла с базой ЭЦН}
	\label{ris:ESP_db_3}
\end{figure}

На листе \mintinline{vb.net}{process} таблицы есть возможность извлечь из базы расходно напорные характеристики одного насоса, а также сохранить файл в формате json. Для использования сгенерированного файла в \unf{} его потребуется вручную переименовать и переместить в папку с надстройкой \unf{}. 



\subsection{ESP\_head\_m – расчёт номинального напора ЭЦН}
Функция позволяет получить паспортные характеристики ЭЦН. Возвращает значение напора при определённой подаче. При указанном значении вязкости нефти пересчитывает паспортные характеристики с учётом вязкости.

\putlisting{listings/ESP_head_m.lst}

Расчёт выполняется на основе паспортных характеристик ЦН из каталога встроенного в надстройку \unf{}. Паспортные характеристики расширены для дебитов превышающих максимальный при котором насос способен развивать положительный напор. Для больших дебитов напор становится отрицательным, то есть насос становится гидравлическим сопротивлением, хотя и продолжает отбирать мощность с вала.

\begin{figure}[H]
	
	\begin{center}
		
		\newcommand{\espBasic}{data/esp_basic.txt}
		\begin{tikzpicture}[scale=1]
			\begin{axis}[
				axis x line=center,
				xtick={0,50,...,300},
				width=14cm,
				height=8cm,
				xlabel={Q, м$^3$/сут},
				ylabel={напор, м},
				legend pos=south west]
				\addplot table [y=head, x=rate]{\espBasic};
				\addlegendentry{напор}
				
			\end{axis}
		\end{tikzpicture}
				
		\caption{Номинальная характеристика центробежного насоса ЭЦН-80 на частоте 60 Гц}
		\label{ris:esp_head_curve}
		
	\end{center}
\end{figure}  

\subsection{ESP\_eff\_fr – расчёт номинального КПД ЭЦН}
Функция позволяет получить паспортные характеристики ЭЦН. Возвращает значение КПД насоса при определённой подаче. При указанном значении вязкости нефти пересчитывает паспортные характеристики с учётом вязкости.

\putlisting{listings/ESP_eff_fr.lst}

Расчёт выполняется на основе паспортных характеристик ЦН из каталога встроенного в надстройку \unf{}. Паспортные характеристики расширены для дебитов превышающих максимальный при котором насос способен развивать положительный напор. Для больших дебитов напор становится отрицательным, а КПД обнуляется. 

\begin{figure}[H]
	
	\begin{center}
		
		\newcommand{\espBasic}{data/esp_basic.txt}
		\begin{tikzpicture}[scale=1]
			\begin{axis}[
  			    axis y line*=left,
  			    axis x line=center,
  			    ymin=-10, ymax=10,
  			    xmin=0, xmax=300,
  			    xtick={0,50,...,250},
				width=14cm,
				height=8cm,
				xlabel={Q, м$^3$/сут},
				ylabel={напор, м},
				]
				\addplot[smooth,mark=*,blue] table [y=head, x=rate]{\espBasic};
				\label{plot_one}
%				\addlegendentry{$head$}
				
				
			\end{axis}
			\begin{axis}[
				axis y line*=right,
				axis x line=none,
				ymin=-1, ymax=1,
				xmin=0, xmax=300,
				width=14cm,
				height=8cm,
				ylabel={КПД, д.е.},
				legend pos=south west]
				\addlegendimage{/pgfplots/refstyle=plot_one}\addlegendentry{напор}
				
				\addplot[smooth,mark=*,red] table [y=eff, x=rate]{\espBasic};
				\addlegendentry{КПД}
				
			\end{axis}
		\end{tikzpicture}
		
		\caption{Номинальная характеристика центробежного насоса ЭЦН-80 на частоте 60 Гц}
		\label{ris:esp_eff_curve}
		
	\end{center}
\end{figure}  

\subsection{ESP\_power\_W – расчёт номинальной мощности потребляемой ЭЦН}
Функция позволяет получить паспортные характеристики ЭЦН. Возвращает значение потребляемой с вала механической мощности при определённой подаче. При указанном значении вязкости нефти пересчитывает паспортные характеристики с учётом вязкости. 

\putlisting{listings/ESP_Power_W.lst}

Расчёт выполняется на основе паспортных характеристик ЦН из каталога встроенного в надстройку \unf{}.  Паспортные характеристики расширены для дебитов превышающих максимальный при котором насос способен развивать положительный напор. Для больших дебитов напор становится отрицательным, а потребляемая мощность остается постоянной равной мощности при нулевом напоре (что неверно и наверное когда то будет улучшено). 

\begin{figure}[H]
	
	\begin{center}
		
		\newcommand{\espBasic}{data/esp_basic.txt}
		\begin{tikzpicture}[scale=1]
			\begin{axis}[
				axis y line*=left,
				axis x line=center,
				ymin=-10, ymax=10,
				xmin=0, xmax=300,
				xtick={0,50,...,250},
				width=14cm,
				height=8cm,
				xlabel={Q, м$^3$/сут},
				ylabel={напор, м},
				]
				\addplot[smooth,mark=*,blue] table [y=head, x=rate]{\espBasic};
				\label{plot_one}
				%				\addlegendentry{$head$}
				
				
			\end{axis}
			\begin{axis}[
				axis y line*=right,
				axis x line=none,
				ymin=0, ymax=300,
				xmin=0, xmax=300,
				width=14cm,
				height=8cm,
				ylabel={мощность, Вт},
				legend pos=south west]
				\addlegendimage{/pgfplots/refstyle=plot_one}\addlegendentry{напор}
				
				\addplot[smooth,mark=*,green] table [y=power, x=rate]{\espBasic};
				\addlegendentry{мощность}
				
			\end{axis}
		\end{tikzpicture}
		
		\caption{Номинальная характеристика центробежного насоса ЭЦН-80 на частоте 60 Гц}
		\label{ris:esp_power_curve}
		
	\end{center}
\end{figure}  

\subsection{ESP\_id\_by\_rate – выбор типового насоса по номинальному дебиту}
Функция возвращает идентификатор типового насоса по заданному номинальному дебиту. 
Может быть использована для выбора насоса на основе его наименования типа ЭЦН 50 - 2000.
\putlisting{listings/ESP_id_by_rate.lst}

\subsection{ESP\_p\_atma – расчёт распределения давления в ЭЦН}
Функция рассчитывает перепад давления, развиваемый ЦН при заданных параметрах флюида и термобарических условиях. Это одна из основных функция расчёта ЭЦН, комбинирующая характеристики из каталога и гидравлическую модель работы ЭЦН.
$$ P_{dis} = P_{int} + \sum_i^n{\rho_{mix,rc}(\bar{P}_{st,i},T) \cdot g \cdot h_{st,i}(Q_{mix,i}(\bar{P}_{st,i},T))} $$
где 


%\begin{table}[H]
		
\begin{tabular}{p{0.1\textwidth}p{0.8\textwidth}}
	
$P_{dis}$ & давление на выкиде насоса; \\
$P_{int}$ & давление на приёме насоса; \\
$i$ & номер ступени, или набора ступеней для ускоренного расчёта; \\
$n$ & количество ступеней или наборов ступеней; \\
$\bar{P}_{st,i}$ & среднее давление на  ступени $i$; \\
$\rho_{mix,rc}$ & плотность ГЖС  в ступени $i$ ; \\
$h_{st,i}$ & напор развиваемый  в ступени $i$; \\
$Q_{mix,i}$ & расход ГЖС в ступени $i$; \\
$g$ & ускорение свободного падения; \\ 

\end{tabular}
%\end{table}


При расчёте сделаны следующие предположения:
\begin{itemize}
	\item не учитывается проскальзывание для асинхронного двигателя. Несмотря на то, что в базе может быть задана частота вращения с учётом проскальзывания, в этой функции считается, что \(slip = 0\) и ЦН вращается с частотой вращения электрического поля заданного параметром \mintinline{vb.net}{freq_Hz}. Для учета проскальзывания следует использовать функцию \mintinline{vb.net}{ESP_system_calc} или скорректировать частоту \mintinline{vb.net}{freq_Hz} вручную.
	\item в расчёте предполагается, что при повышении давления свободный газ растворится в нефти в соответствии с заданными PVT параметрами. Фактически работает опция - свободный газ растворяется. Для того, чтобы реализовать вариант расчёта при котором свободный газ при повышении давления не успеет раствориться в нефти следует модифицировать свойства флюида поступающего в насос так, чтобы запретить его растворение больше определённого предела (изменить давление насыщения $P_b$ и газосодержание при давлении насыщения $r_{sb}$)
	\item возможен как расчёт давления на выкиде по давлению на приёме, так и расчёт давления на приёме по давлению на выкиде (регулируется параметром \mintinline{vb.net}{calc_along_flow}). При этом расчёт ведётся непосредственным интегрированием по ступеням ЭЦН с шагом \mintinline{vb.net}{dnum_stages_integrate}, задаваемым как опция для \mintinline{vb.net}{param}. Расчёт против потока, при котором по давлению на выкиде рассчитывается давление на приёме следует применять с осторожностью. В этом варианте не сработают поправки на влияние газа, так как они предполагаю расчёт величины поправки от доли газа на приёме, которая не известна при старте расчёта. Кроме того при большом шаге интегрирования \mintinline{vb.net}{dnum_stages_integrate}) может накапливаться ошибка влияния газа при низких давлениях. Более надёжным вариантом расчёта давления на приёме по известному давлению на выкиде будет итеративный расчёт (подбор такого давления на приёме при котором будет обеспечиваться заданное давление на выкиде)
	\item температурный расчёт ЭЦН - расчёт температуры флюида на выкиде насоса - возможен только для варианта расчёта от давления на приёме к давлению на выкиде  \mintinline{vb.net}{calc_along_flow=True}). При этом не учитывается эмиссия тепла в окружающее пространство от корпуса насоса. Предполагается, что все выделившееся тепло идёт на нагрев флюида. Температурный расчет активируется если \mintinline{vb.net}{t_dis_C} задано отрицательным, иначе температура по ступеням линейно интерполируется между заданными значениями.
	
\end{itemize}

\putlisting{listings/ESP_p_atma.lst}

Часть настроек управляющая выводом результатов задается в виде закодированной строки в аргументе \mintinline{vb.net}{param}.

\begin{table}[H]
	\caption{Параметры функции \mintinline{vb.net}{ESP_p_atma} передаваемые через аргумент -- \mintinline{vb.net}{param}}
	\label{table:param_ESP_p_atma}
	\begin{tabular}{p{0.2\textwidth}p{0.75\textwidth}}
		\hline
		Ключ & Описание  \\ \hline
		\mintinline{vb.net}{show_array} & Показывать расширенные результаты расчета: 0 -- результат в виде одного числа (значение по умолчанию), 1 -- результат в виде массива.    \\ \hline
		
		\mintinline{vb.net}{show_log} & Показывать лог расчета в выводе. 0 -- лог выводиться не будет, 1 -- будет показан лог в виде json строки в массиве вывода. Большой размер лога может вызвать проблемы на некоторых версиях Excel.   \\ \hline
		
		\mintinline{vb.net}{num_value} & Номер параметра выводимого на первом месте. Позволяет подменить выводимый параметр при \mintinline{vb.net}{show_array=0} на необходимый. Номера можно определить по расширенному выводу при \mintinline{vb.net}{show_array=1}  \\ \hline
		
		\mintinline{vb.net}{dnum_stages_integrate} & Шаг интегрирования по ступеням. По умолчанию для ускорения расчет равен \mintinline{vb.net}{dnum_stages_integrate=10}. Установка \mintinline{vb.net}{dnum_stages_integrate=1} должно улучшить точность расчета   \\ \hline
				
		\mintinline{vb.net}{out_points} & Количество точек для вывода векторных результатов. По умолчанию \mintinline{vb.net}{out_points = 20}   \\ \hline
	\end{tabular}
\end{table}

При включенной опции \mintinline{vb.net}{show_array=1} результат выдается в виде двумерного массива значений - плоской таблицы. Результирующая таблица может быть непосредственно выведена в ячейки Excel (в версиях не поддерживающие динамические массивы необходимо использовать Cntrl-Shift-Enter для вывода результата в заранее выделенный диапазон ячеек) или получена в виде массива при вызове из VBA.

При выводе массива на лист Excel первая строка содержит значения параметров, вторая подписи к значениям. При выводе с использованием Cntrl-Shift-Enter можно вывести только первую строку параметров и распространить расчетную формулу "протягиванием" на несколько строк.

\begin{table}[H]
	\caption{Расширенный вывод функции \mintinline{vb.net}{ESP_p_atma} }
	\label{table:res_ESP_p_atma}
	\begin{tabular}{p{0.05\textwidth}p{0.25\textwidth}p{0.65\textwidth}}
		\hline
		№& Параметр & Описание  \\ \hline
		0 & \mintinline{vb.net}{p_dis_atma} & Параметр который выводится при \mintinline{vb.net}{show_array=0} или при подавлении вывода массива. Может быть настроен опцией  \mintinline{vb.net}{num_value}. По умолчанию давление на выкиде ЭЦН. \\ \hline
		
		1 & \mintinline{vb.net}{p_int_atma} & Давление на приеме насоса, атм    \\ \hline
		2 & \mintinline{vb.net}{t_int_C} &   Температура на приеме насоса, С    \\ \hline
		3 & \mintinline{vb.net}{p_dis_atma} & Давление на выкиде насоса, атм     \\ \hline
		4 & \mintinline{vb.net}{t_dis_C} & Температура на выкиде насоса, С     \\ \hline
		5 & \mintinline{vb.net}{head_m} & Фактические напор развиваемый насосом, м   \\ \hline
		6 & \mintinline{vb.net}{eff_ESP_d} & Фактический гидравлический КПД насоса, проценты \\ \hline
		7 & \mintinline{vb.net}{power_fluid_W} & Фактическая гидравлическая мощность развиваемая насосом, Вт \\ \hline
		8 & \mintinline{vb.net}{power_ESP_W} & Фактическая потребляемая с вала механическая мощность насоса, Вт \\ \hline
		9 & \mintinline{vb.net}{gas_correction} & Поправке на газ \\ \hline
		10 & \mintinline{vb.net}{log} & Лог расчета, выводится при \mintinline{vb.net}{show_log = 1}  \\ \hline
		
	\end{tabular}
\end{table}

Векторные результаты перечисленные ниже могут быть использованы для построения графиков и для проверки корректности расчета.

\begin{table}[H]
	\caption{Расширенный вывод функции \mintinline{vb.net}{ESP_p_atma}. Векторные результаты}
	\label{table:res_list_ESP_p_atma}
	\begin{tabular}{p{0.05\textwidth}p{0.25\textwidth}p{0.55\textwidth}}
		1 & \mintinline{vb.net}{n_stage} & Вектор номеров ступеней   \\ \hline
		
		2 & \mintinline{vb.net}{length_m} & Вектор координат ступеней (длина), м   \\ \hline
		3 & \mintinline{vb.net}{p,atma} & Вектор давлений, соответствующих заданным ступеням, атм\\ \hline
		4 & \mintinline{vb.net}{t,C} & Вектор температур флюида, соответствующих заданным ступеням, С   \\ \hline
		5 & \mintinline{vb.net}{gas_fraction} & Вектор расходных долей газа в потоке, соответствующих заданным ступеням, проценты  \\ \hline
		6 & \mintinline{vb.net}{qmix_rm3day} & Вектор объемных расходов газожидкостной смеси, соответствующих заданным ступеням, м3/сут   \\ \hline
		7 & \mintinline{vb.net}{power_fluid_W} & Вектор значений фактической гидравлической мощности для ступеней ниже заданной, Вт \\ \hline
		8 & \mintinline{vb.net}{power_ESP_W} & Вектор значений фактической потребляемой с вала механическая мощности для ступеней ниже заданной, Вт  \\ \hline
		
		9 & \mintinline{vb.net}{eff fluid} & Вектор значений КПД для заданной ступени, проценты  \\ \hline
		
		
		10 & \mintinline{vb.net}{mu_stage_cP} & Вектор значений вязкости на заданной ступени  \\ \hline
		11 & \mintinline{vb.net}{gas correction} & Вектор значений поправки на влияние газа по ступеням \\ \hline
		
	\end{tabular}
\end{table}


\begin{comment}
\subsection{ESP\_calibr\_pump – подбор подстроечных параметров ЭЦН}

Функция позволяет по известным значениям давления на приеме насоса и на выкиде насоса найти значения калибровочных параметров - калибровки по напору и по расходу. Ищется только одно значение калибровочного параметра.

%\putlisting{listings/ESP_calibr_pump.lst}


\subsection{Кодирование параметров ЭЦН в строке}
Для удобства работы с функциями учитывающими наличие ЭЦН в скважине созданы функции кодирования параметров УЭЦН в строке. Аналогично функциям кодирования PVT параметров, такие функции позволяют передать все необходимые данные о ЭЦН одним параметром.

Реализованы две функции - кодирования и декодирования строки ЭЦН.

%\putlisting{listings/ESP_pump_encode_string.lst}

%\putlisting{listings/ESP_motor_encode_string.lst}

%\putlisting{listings/ESP_cable_encode_string.lst}

%\putlisting{listings/ESP_separation_encode_string.lst}


\subsection{ESP\_system\_calc – расчет параметров работы УЭЦН}
Функция рассчитывает полный набор параметров работы УЭЦН при заданных параметрах флюида и термобарических условиях. В отличии от функции  \mintinline{vb.net}{ESP_p_atma} учитывает проскальзывание при расчете частоты вращения вала и рассчитывает электрические параметры работы ЭЦН.

\begin{figure}[H]
	\begin{center}
		\input{draw/ESP_well_2}
		\caption{Схема конструктивных элементов ЭЦН}
		\label{ris:ESP_well_2_1}
	\end{center}
\end{figure}


\putlisting{listings/ESP_system_calc.lst}


\subsection{Электромеханический расчёт погружного электрического двигателя ПЭД}
Рассматривается асинхронный электрический двигатель. 

Погружные асинхронные электрические двигатели для добычи нефти выполняются трехфазными. 

Впервые конструкция трёхфазного асинхронного двигателя была разработана, создана и опробована русским инженером М. О. Доливо-Добровольским в 1889-91 годах. Демонстрация первых двигателей состоялась на Международной электротехнической выставке во Франкфурте на Майне в сентябре 1891 года. Были представлены три трёхфазных двигателя разной мощности. Самый мощный из них имел мощность 1.5 кВт и использовался для приведения во вращение генератора постоянного тока. Конструкция асинхронного двигателя, предложенная Доливо-Добровольским, оказалась очень удачной и является основным видом конструкции этих двигателей до настоящего времени.

За прошедшие годы асинхронные двигатели нашли широкое применение в различных отраслях промышленности. Их используют в электроприводе металлорежущих станков, подъёмно-транспортных машин, транспортёров, насосов, вентиляторов. Маломощные двигатели используются в устройствах автоматики. Широкое применение асинхронных двигателей объясняется их достоинствами по сравнению с другими двигателями: высокая надёжность, возможность работы непосредственно от сети переменного тока, простота обслуживания.

Для расчёта электромеханических параметров погружных электрических двигателей полезно понимать теоретические основы их работы. Теория работы погружных асинхронных двигателей не отличается от теории применимой к двигателям применяемым на поверхности. Далее кратко изложены основные положения теории. 

Трехфазная цепь является частным случаем многофазных систем электрических цепей, представляющих собой совокупность электрических цепей, в которых действуют синусоидальные ЭДС одинаковой частоты, отличающиеся по фазе одна от другой и создаваемые общим источником энергии.
Переменный ток, протекающий по трехфазной цели, характеризуется следующими параметрами:

\begin{itemize}
	\item Фазное напряжение $U_A, U_B, U_C $ - напряжение между линейным проводом и нейтралью
	\item Линейное напряжение $U_{AB}, U_{BC}, U_{CA} $ - напряжение между одноименными выводами разных фаз
	\item Фазный ток $I_{phase}$ – ток в фазах двигателя.
	\item Линейный ток $I_{line}$ – ток в линейных проводах.
	\item $ \cos \varphi $ - коэффициент мощности, где $ \varphi$ величина сдвига по фазе между напряжением и током 
\end{itemize}

Подключение двигателя к цепи трёхфазного тока может быть выполнено по схеме "звезда"\ или "треугольник".


\begin{figure}[H]
	\centering
	\input{draw/circut_star_triangle}
	\caption{Схема соединения обмоток ЭЦН}
	\label{ris:electicity_triangle_star}
\end{figure}

Для схемы звезда фазное напряжение меньше линейного в $\sqrt{3}$ раз.

$$ U_{AB} = \sqrt{3} U_{A} $$
$$ I_{phase} = I_{line} $$

Для схемы треугольник 

$$ U_{AB} =  U_{A} $$
$$ I_{line} =\sqrt{3} I_{phase} $$


В погружных двигателях обычно применяет схема подключения звезда. Эта схема обеспечивает более низкое напряжение в линии, что способствует повышению КПД передачи энергии по длинному кабелю. Еще есть причины?
При схеме подключения звезда токи в линии и в фазной обмотке статора двигателя совпадают, поэтому значение тока обозначают $I$ не указывая индекс в явном виде. Поскольку линейное напряжения проще измерить и легче контролировать параметры трехфазного двигателя обычно задаются линейными. В частности номинальное напряжение питания двигателя это линейное напряжение (напряжение между фазами). Далее линейное напряжение будет обозначать без индекса как $U$

Активная электрическая мощность в трехфазной цепи задается выражением 
$$ P= \sqrt{3}U I \cos \varphi$$

Реактивная мощность 
$$ Q= \sqrt{3}U I \sin \varphi$$

Соответственно полная мощность 
$$ S= \sqrt{3}U I $$

Активная мощность -- мощность, которая идет непосредственно на совершение работы электронной машиной. Именно активная мощность обычно учитывается при контроле электроэнергии. За нее идет оплата потребления. Реактивная мощность не потребляется в явном виде двигателем, но при этом циркулирует в сети и, например, вызывает дополнительное падение напряжения и выделение мощности в кабельной линии. Для систем УЭЦН где кабельные линии достаточно длинны реактивная мощность нежелательна. Применение фильтром на устье скважины может увеличить значение коэффициента мощности $ \cos \varphi$ и тем самым снизить реактивную мощность, что может привести к заметному снижению потреблению энергии для мощных установок. Кроме того $ \cos \varphi$ влияет на работу двигателя, его рекомендуется по возможности поддерживать высоким. 

\subsubsection{ Устройство трёхфазной асинхронной машины}
Неподвижная часть машины называется статор, подвижная – ротор. Обмотка статора состоит из трёх отдельных частей, называемых фазами.

При подаче переменного напряжения и тока на обмотки статора внутри статора формируется вращающееся магнитное поле. Частота вращения магнитного поля совпадает с частотой питающего напряжения. 

Описание модели асинхронного двигателя приведенное далее сформировано по \cite{Gridin, Gridin_2018} и основано на простой Г-образной схеме замещения. 

Магнитный поток $\Phi $ и напряжение подаваемое на статор связаны приближенным соотношением 
$$ U_1 \approx E_1 = 4.44 w_1 k_1 f \Phi $$
где 

 $\Phi$ -  магнитный поток;
 
 $U_1$ -	напряжение в одной фазе статора;
 
 $f$   - частота сети;
 
 $E_1$	- ЭЦН в фазе статора;
 
 $w_1$ - число витков одной фазы обмотки статора;
 
 $k_1$  - обмоточный коэффициент.
   
Из этого выражения следует, что магнитный поток $\Phi $ в асинхронной машине не зависит от её режима работы, а при заданной частоте сети $f$ зависит только от действующего значения приложенного напряжения $U_1$. Причем магнитный поток пропорционален отношению напряжения к частоте тока 

$$ \Phi  \sim  \frac{U_1}{f}   $$

Для ЭДС ротора можно записать выражение 


$$  E_2 = 4.44 w_2 k_2 f S \Phi $$

где 


$S$ - величина скольжения (проскальзывания);

$E_2$	- ЭЦН в фазе ротора;

$w_2$ - число витков одной фазы обмотки ротора;

$k_2$ - обмоточный коэффициент ротора.

ЭДС, наводимая в обмотке ротора, изменяется пропорционально скольжению и в режиме двигателя имеет наибольшее значение в момент пуска в ход.
Для тока ротора в общем случае можно получить такое соотношение

$$  I_2 = \frac{E_2 S}{\sqrt{R_2^2+(S X_2^2)}} $$

где 

$R_2$ -  активное сопротивление обмотки ротора, связанное с потерями на нагрев обмотки;  

$X_2 = 2 \pi f L_2$ - индуктивное сопротивление обмотки неподвижного ротора, связанное с потоком рассеяния;

Отсюда следует, что ток ротора зависит от скольжения и возрастает при его увеличении, но медленнее, чем ЭДС.

Для асинхронного двигателя можно получить следующее выражение для механического момента 

$$ M = \frac{1}{4.44 w_2 k_2 k_T^2 f} \frac{U_1^2 R_2 S}{R_2^2 + (S X_2^2)^2}$$

где 

$k_T = \frac{E_1}{E_2} = \frac{w_1 k_1}{w_2 k_2}$ - коэффициент трансформации асинхронной машины

Из полученного выражения для электромагнитного момента следует, что он сильно зависит от подведённого напряжения $M \sim U_1^2$. При снижении, например, напряжения на 10\%, электромагнитный момент снизится на 19\% $M \sim (0,9U_1)^2=0.81 U_1^2)$. Это является одним из недостатков асинхронных двигателей. Также можно заметить, что $M \sim \dfrac{U_1^2}{f} $. При одновременном изменении частоты и напряжения, таком что их отношение останется постоянным момент изменится. 


Электромеханическая модель погружного АПЭД реализована в расчетных функциях \unf{} как модель двигателя с номером 2  \mintinline{vb.net}{motorID = 2}

Функции для расчета характеристик ПЭД начинаются с префикса \mintinline{vb.net}{motor_}. Описание функций можно найти в приложении "Автоматически сгенерированное описание".

\subsubsection{Каталожные характеристики АПЭД}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\linewidth]{novomet_motor_1}
	\caption{Каталожные характеристики ПЭД. Источник \cite{Novomet_2013} }
	\label{ris:novomet_motor_1}
\end{figure}

Для асинхронных погружных двигателей производители в каталогах оборудования приводят характеристики, позволяющие оценить КПД, потребляемый ток, частоту вращения вала и коэффициент электрической мощности от загрузки для определенной частоты вращения - рисунок \ref{ris:novomet_motor_1}. Нередко характеристики приводятся для двух частот вращения - 50Гц и 60 Гц.


Каталожная модель погружного АПЭД реализована в расчетных функциях \unf{} как модель двигателя с номером 1  \mintinline{vb.net}{motorID = 1}

Функции для расчета характеристик ПЭД начинаются с префикса \mintinline{vb.net}{motor_}. Описание функций можно найти в приложении "Автоматически сгенерированное описание".



\newpage
\end{comment}